common:
  speed:
    slowly: &SLOWLY
      speed: 0.2
      accel: 0.1
      timeout: 15.
    normally: &NORMALLY
      speed: 0.4
      accel: 0.3
      timeout: 8.
    joint6_normally: &JOINT6_NORMALLY
      speed: 0.4
      accel: 0.3
      timeout: 2.
    quickly: &QUICKLY
      speed: 0.6
      accel: 0.6
      timeout: 7.

  tolerance:
    small_tolerance: &SMALL_TOLERANCE
      tolerance_joints: [ 0.008, 0.008, 0.008, 0.01, 0.01, 0.01 ]
    normal_tolerance: &NORMAL_TOLERANCE
      tolerance_joints: [ 0.008, 0.008, 0.008, 0.1, 0.1, 0.1 ]
    bigger_tolerance: &BIGGER_TOLERANCE
      tolerance_joints: [ 0.01, 0.01, 0.01, 0.3, 0.2, 0.2 ]
    test_tolerance: &TEST_TOLERANCE
      tolerance_joints: [ 0.01, 0.01, 0.01, 0.2, 0.2, 0.01 ]

  joint1:
    down_position: &JOINT1_DOWN_POSITION
                     -0.029600
    zero_stone_position: &JOINT1_ZERO_STONE_POSITION
                           0.02
    one_stone_position: &JOINT1_ONE_STONE_POSITION
                          0.107
    take_one_stone_position: &JOINT1_TAKE_ONE_STONE_POSITION
                               0.134
    stone_storage_high_position: &STONE_STORAGE_HIGH_POSITION
                                   0.245
    take_two_stone_position: &JOINT1_TAKE_TWO_STONE_POSITION
                               0.327
    take_three_stone_position: &JOINT1_TAKE_THREE_STONE_POSITION
                                 0.327
    get_stone_position: &JOINT1_GET_STONE_POSITION
                          0.286600
    get_stone_low_position: &JOINT1_GET_STONE_LOW_POSITION
                              0.246600
    two_stone_position: &JOINT1_TWO_STONE_POSITION
                          0.309
    three_stone_position: &JOINT1_THREE_STONE_POSITION
                            0.4192
    up_position: &JOINT1_UP_POSITION
                   0.43
    ready_to_get_stone: &JOINT1_READY_TO_GET_STONE_POSITION
                          0.438
    get_ground_stone: &JOINT1_GET_GROUND_STONE_POSITION
                        0.170
    go_get_ground_stone: &JOINT1_GO_GET_GROUND_STONE
                           0.11


  joint2:
    back_position: &JOINT2_BACK_POSITION
                     -0.043050
    recently_position: &JOINT2_RECENTLY_POSITION
                         -0.043050
    reversal_position: &JOINT2_REVERSAL_POSITION
                         0.07
    avoid_line_collision_position: &JOINT2_AVOID_LINE_COLLISION_POSITION
                                     0.27
    sky_position: &JOINT2_SKY_POSITION
                    0.304
    furthest_position: &JOINT2_FURTHEST_POSITION
                         0.310
    ground_stone_position: &JOINT2_GROUND_STONE_POSITION
                             0.01273
  joint3:
    lf_take_position: &JOINT3_LF_TAKE_POSITION
                        0.265600
    lf_take_right_position: &JOINT3_LF_TAKE_RIGHT_POSITION
                              0.2012
    rt_take_position: &JOINT3_RT_TAKE_POSITION
                        -0.249200
    rt_take_right_position: &JOINT3_RT_TAKE_RIGHT_POSITION
                              -0.249200
    mid_position: &JOINT3_MID_POSITION
                    0.007
    mid_take_right_position: &JOINT3_MID_TAKE_RIGHT_POSITION
                               -0.056150
    sky_ground_store_position: &JOINT3_SKY_GROUND_STORE_POSITION
                                 -0.27845
    take_store_position: &JOINT3_TAKE_STORE_POSITION
                           -0.2167
    store_stone_position: &JOINT3_STORE_STONE_POSITION
                            -0.2582
    drag_car_position: &JOINT3_DRAG_CAR_POSITION
                         -0.193102
  joint4:
    up_position: &JOINT4_UP_POSITION
                   -1.771
    ready_position: &JOINT4_READY_POSITION
                      -1.771
    down_position: &JOINT4_DOWN_POSITION
                     -0.114
    has_stone_position: &JOINT4_HAS_STONE_POSITION
                          -1.607
    drag_car_position: &JOINT4_DRAG_CAR_POSITION
                         -0.388
  joint5:
    left_position: &JOINT5_LEFT_POSITION
                     1.528
    left_more_position: &JOINT5_LEFT_MORE_POSITION
                          1.656
    mid_position: &JOINT5_MID_POSITION
                    -0.027080
    reversal_position: &JOINT5_REVERSAL_POSITION
                         0.011
    drag_car_position: &JOINT5_DRAG_CAR_POSITION
                         0.4977
  joint6:
    up_position: &JOINT6_UP_POSITION
                   -0.028
    down_position: &JOINT6_DOWN_POSITION
                     3.23
    back_position: &JOINT6_BACK_POSITION
                     1.55
    hold_stone: &JOINT6_HOLD_STONE_POSITION
                  -0.2567
    reversal: &JOINT6_REVERSAL_POSITION
                1.0
    drag_car_position: &JOINT6_DRAG_CAR_POSITION
                1.631

  gripper:
    open_gripper: &OPEN_GRIPPER
      state: false
    close_gripper: &CLOSE_GRIPPER
      state: true

  arm:
    home_zero_stone: &HOME_ZERO_STONE
      joints: [ *JOINT1_ZERO_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
      common:
        <<: *NORMALLY
      tolerance:
        <<: *NORMAL_TOLERANCE
    home_one_stone: &HOME_ONE_STONE
      joints: [ *JOINT1_ONE_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_HAS_STONE_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
      common:
        <<: *NORMALLY
      tolerance:
        <<: *NORMAL_TOLERANCE
    home_two_stone: &HOME_TWO_STONE
      joints: [ *JOINT1_TWO_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_HAS_STONE_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
      common:
        <<: *NORMALLY
      tolerance:
        <<: *NORMAL_TOLERANCE
    home_three_stone: &HOME_THREE_STONE
      joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_HAS_STONE_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
      common:
        <<: *NORMALLY
      tolerance:
        <<: *NORMAL_TOLERANCE
    pick_wait: &PICK_WAIT
      joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
      common:
        <<: *NORMALLY
      tolerance:
        <<: *BIGGER_TOLERANCE

  gimbal:
    sky_gimbal: &SKY_POS
      frame: gimbal_base
      position: [ 2, 0., 0.5 ]
    back_gimbal: &BACK_POS
      frame: gimbal_base
      position: [ -2 ,0., 0. ]
    side_gimbal: &SIDE_POS
      frame: gimbal_base
      position: [ -0.1 ,3, 0. ]
    island_gimbal: &ISLAND_POS
      frame: gimbal_base
      position: [ 2 ,0., 0. ]
    ground_pos: &GROUND_POS
      frame: gimbal_base
      position: [ 2 ,0., -0.8 ]
    reversal_pos: &REVERSAL_POS
      frame: gimbal_base
      position: [ 2,0., -0.25 ]
    exchange_pos: &EXCHANGE_POS
      frame: gimbal_base
      position: [ 0.,-3, -2.3 ]


  reversal:
    velocity_stop: &VELOCITY_STOP
      mode: "VELOCITY"
      values: [ 0.,0.,0.,0.,0.,0. ]
    velocity_z_out: &VELOCITY_Z_OUT
      mode: "VELOCITY"
      values: [ 0.,0.,1.,0.,0.,0. ]
    velocity_z_in: &VELOCITY_Z_IN
      mode: "VELOCITY"
      values: [ 0.,0.,-0.7,0.,0.,0. ]
    velocity_z_in_delay: &VELOCITY_Z_IN_DELAY
      mode: "VELOCITY"
      values: [ 0.,0.,-0.7,0.,0.,0. ]
      delay: 1.5
    position_z_out: &POSITION_Z_OUT
      mode: "POSITION"
      values: [ 0.,0.,10.,0.,0.,0. ]
    position_pitch_out: &VELOCITY_PITCH_OUT
      mode: "POSITION"
      values: [ 0.,0.,10.,0.,-1.,0. ]
    position_pitch_reversal_pi_2: &POSITION_PITCH_REVERSAL_PI_2
      mode: "POSITION"
      values: [ 0.,0.,0.,0.,21.,0. ]
      delay: 0.6
    position_pitch_reversal_pi: &POSITION_PITCH_REVERSAL_PI
      mode: "POSITION"
      values: [ 0.,0.,0.,0.,42.,0. ]
      delay: 0.8

    chassis_backward: &CHASSIS_BACKWARD
      frame: base_link
      position: [ -0.10, 0. ]
      yaw: 0.0
      chassis_tolerance_position_: 0.04
      chassis_tolerance_angular_: 0.2



steps_list:
  ################### COMMON STEP####################
  DELETE_SCENE:
    - step: "delete_scene"
  ################### GIMBAL ####################
  SKY_GIMBAL:
    - step: "sky island gimbal"
      gimbal:
        <<: *SKY_POS
  ISLAND_GIMBAL:
    - step: "island gimbal"
      gimbal:
        <<: *ISLAND_POS
  BACK_GIMBAL:
    - step: "back gimbal"
      gimbal:
        <<: *BACK_POS
  SIDE_GIMBAL:
    - step: "side gimbal"
      gimbal:
        <<: *SIDE_POS
  GROUND_GIMBAL:
    - step: "ground gimbal"
      gimbal:
        <<: *GROUND_POS
  REVERSAL_GIMBAL:
    - step: "reversal gimbal"
      gimbal:
        <<: *REVERSAL_POS
  EXCHANGE_GIMBAL:
    - step: "exchange gimbal"
      gimbal:
        <<: *EXCHANGE_POS
  ################### GRIPPER ####################
  OPEN_GRIPPER:
    - step: "open gripper"
      gripper:
        <<: *OPEN_GRIPPER

  CLOSE_GRIPPER:
    - step: "close gripper"
      gripper:
        <<: *CLOSE_GRIPPER
  ################### CHASSIS ####################
  CHASSIS_FORWARD:
    - step: "forward"
      chassis:
        frame: base_link
        position: [ 0.3, 0. ]
        yaw: 0.0
        chassis_tolerance_position_: 0.025
        chassis_tolerance_angular_: 0.1

  CHASSIS_BACKWARD:
    - step: "backward"
      chassis:
        frame: base_link
        position: [ -0.10, 0. ]
        yaw: 0.0
        chassis_tolerance_position_: 0.04
        chassis_tolerance_angular_: 0.2

  CHASSIS_LEFT:
    - step: "left"
      chassis:
        frame: base_link
        position: [ 0., 0.5 ]
        yaw: 0.0
        chassis_tolerance_position_: 0.1
        chassis_tolerance_angular_: 0.01

  CHASSIS_RIGHT:
    - step: "right"
      chassis:
        frame: base_link
        position: [ 0., -0.5 ]
        yaw: 0.0
        chassis_tolerance_position_: 0.1
        chassis_tolerance_angular_: 0.01

  CHASSIS_ROTATE:
    - step: "rotate"
      chassis:
        frame: base_link
        position: [ 0., 0. ]
        yaw: 3.14
        chassis_tolerance_position_: 1.
        chassis_tolerance_angular_: 0.01

  ################### CHASSIS ####################

  ################### HOME ####################

  HOME_ZERO_STONE:
    - step: "avoid collision"
      arm:
        joints: [ *JOINT1_ZERO_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "home with no stone"
      arm:
        <<: *HOME_ZERO_STONE
  HOME_ONE_STONE:
    - step: "home with one stone"
      arm:
        <<: *HOME_ONE_STONE
  HOME_TWO_STONE:
    - step: "home with two stone"
      arm:
        <<: *HOME_TWO_STONE
  HOME_THREE_STONE:
    - step: "home with three stone"
      arm:
        <<: *HOME_THREE_STONE

  ################### DRAG ####################
  ENGINEER_DRAG_CAR0:
    - step: "gimbal ready"
      gimbal:
        <<: *GROUND_POS
    - step: "avoid collision"
      arm:
        joints: [ *JOINT1_TAKE_ONE_STONE_POSITION, *JOINT2_REVERSAL_POSITION, *JOINT3_DRAG_CAR_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DRAG_CAR_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "ready to drag car"
      arm:
        joints: [ *JOINT1_TAKE_ONE_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_DRAG_CAR_POSITION, *JOINT4_DRAG_CAR_POSITION, *JOINT5_DRAG_CAR_POSITION, *JOINT6_DRAG_CAR_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  ENGINEER_DRAG_CAR00:
    - step: "gimbal ready"
      gimbal:
        <<: *EXCHANGE_POS
  ENGINEER_DRAG_CAR000:
    - step: "gimbal ready"
      gimbal:
        <<: *SIDE_POS
    - step: "ready to drag car"
      arm:
        <<: *HOME_ZERO_STONE

  ################### GROUND ####################
  GROUND_STONE0:
    - step: "gimbal ready"
      gimbal:
        <<: *GROUND_POS
    - step: "ready to get ground stone"
      arm:
        joints: [ *JOINT1_GET_GROUND_STONE_POSITION, *JOINT2_GROUND_STONE_POSITION, *JOINT3_MID_POSITION, *JOINT4_DOWN_POSITION, *JOINT5_MID_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  GROUND_STONE00:
    - step: "change gripper state"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "get ground stone"
      arm:
        joints: [ *JOINT1_GO_GET_GROUND_STONE, *JOINT2_GROUND_STONE_POSITION, *JOINT3_MID_POSITION, *JOINT4_DOWN_POSITION, *JOINT5_MID_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  GROUND_STONE000:
    - step: "move joint1 and 3"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_GROUND_STONE_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *SLOWLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "move joint2"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
  GROUND_STONE0000:
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "close gripper"
      gripper:
        <<: *CLOSE_GRIPPER
    - step: "avoid collision"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_REVERSAL_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  GROUND_STONE00000:
    - step: "open gripper"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL OUT"
      reversal:
        <<: *POSITION_Z_OUT
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  ################### EXCHANGE ####################
  EXCHANGE_WAIT:
    - step: "move to exchange wait state"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_REVERSAL_POSITION, *JOINT3_LF_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  EXCHANGE_CONTINUE:
    - step: "move to exchange position last"
      arm:
        joints: [ "KEEP", "KEEP", "KEEP", "KEEP", "KEEP", "KEEP" ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  ###################    SKY_BIG_ISLAND    ####################
  SKY_BIG_ISLAND0:
    - step: "arm wait state"
      arm:
        <<: *PICK_WAIT
  SKY_BIG_ISLAND00:
    - step: "change gripper state"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "move to wait stone down"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_SKY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  SKY_BIG_ISLAND000:
    - step: "move joint1 and 3"
      arm:
        joints: [ *JOINT1_TWO_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_SKY_GROUND_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_TWO_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_SKY_GROUND_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *SLOWLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "close gripper"
      gripper:
        <<: *CLOSE_GRIPPER
    - step: "home with no stone"
      arm:
        <<: *HOME_ONE_STONE
    - step: "REVERSAL STOP"
      reversal:
        <<: *VELOCITY_STOP
    ###################    BIG_ISLAND    ####################
    ###################    MID    ################
  BIG_ISLAND0:
    - step: "arm wait"
      arm:
        <<: *PICK_WAIT
  BIG_ISLAND00:
    - step: "add scenes"
      scene_name: MID_BIG_ISLAND
    - step: "arm ready to get"
      arm:
        joints: [ *JOINT1_READY_TO_GET_STONE_POSITION, *JOINT2_FURTHEST_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "delete_scene"
  BIG_ISLAND000:
    - step: "change gripper state"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "get stone"
      arm:
        joints: [ *JOINT1_GET_STONE_LOW_POSITION, *JOINT2_FURTHEST_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "up stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_FURTHEST_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "reversal stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_REVERSAL_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  BIG_ISLAND0000:
    - step: "move joint1 and 3"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_BACK_POSITION, *JOINT3_SKY_GROUND_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "move joint6"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_BACK_POSITION, *JOINT3_SKY_GROUND_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *SLOWLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "close gripper"
      gripper:
        <<: *CLOSE_GRIPPER
    - step: "home with no stone"
      arm:
        <<: *HOME_TWO_STONE
    - step: "REVERSAL STOP"
      reversal:
        <<: *VELOCITY_STOP
  ###################    SMALL_ISLAND    ####################
  LF_SMALL_ISLAND0:
    - step: "island gimbal"
      gimbal:
        <<: *ISLAND_POS
    - step: "arm wait"
      arm:
        <<: *PICK_WAIT
  LF_SMALL_ISLAND00:
    - step: "add scenes"
      scene_name: MID_SMALL_ISLAND
    - step: "arm ready to get stone"
      arm:
        joints: [ *JOINT1_READY_TO_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_LF_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "change gripper state"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "move arm down to gain stone"
      arm:
        joints: [ *JOINT1_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_LF_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "move arm up"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_LF_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "move arm right"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_LF_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "reversal stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_LF_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION, *JOINT5_REVERSAL_POSITION, *JOINT6_REVERSAL_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_OUT
    - step: "arm wait"
      arm:
        <<: *PICK_WAIT
    ###################    MID    ################
  SMALL_ISLAND0:
    - step: "island gimbal"
      gimbal:
        <<: *ISLAND_POS
    - step: "arm wait"
      arm:
        <<: *PICK_WAIT
    - step: "chassis back"
      chassis:
        <<: *CHASSIS_BACKWARD
    - step: "add scenes"
      scene_name: MID_SMALL_ISLAND
    - step: "arm ready to get stone"
      arm:
        joints: [ *JOINT1_READY_TO_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "delete_scene"
  SMALL_ISLAND000:
    - step: "change gripper state"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "arm get stone"
      arm:
        joints: [ *JOINT1_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "arm up stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "arm right stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "reversal stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION, *JOINT5_REVERSAL_POSITION, *JOINT6_REVERSAL_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "arm back"
      arm:
        <<: *PICK_WAIT


    ###################    RT    ################
  RT_SMALL_ISLAND0:
    - step: "island gimbal"
      gimbal:
        <<: *ISLAND_POS
    - step: "arm wait"
      arm:
        <<: *PICK_WAIT
  RT_SMALL_ISLAND00:
    - step: "add scenes"
      scene_name: MID_SMALL_ISLAND
    - step: "arm ready"
      arm:
        joints: [ *JOINT1_READY_TO_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_RT_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "change gripper state"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "arm get stone"
      arm:
        joints: [ *JOINT1_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_RT_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "arm up stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_RT_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "arm up stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_RT_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "reversal stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_RT_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION, *JOINT5_REVERSAL_POSITION, *JOINT6_REVERSAL_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_OUT
    - step: "arm back"
      arm:
        <<: *PICK_WAIT
      ###################    SMALL_ISLAND    ####################
      ###################    STORE    ####################
  STORE_WHEN_ZERO_STONE0:
    - step: "open gripper"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "move joint1 and 3"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "move joint6"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "close gripper"
      gripper:
        <<: *CLOSE_GRIPPER
    - step: "avoid collision"
      arm:
        joints: [ *JOINT1_ONE_STONE_POSITION, *JOINT2_REVERSAL_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "move joint6"
      arm:
        <<: *HOME_ONE_STONE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_STOP

  STORE_WHEN_ONE_STONE0:
    - step: "open gripper"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "move joint1 and 3"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "move joint6"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *SLOWLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "close gripper"
      gripper:
        <<: *CLOSE_GRIPPER
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_TWO_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *SLOWLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_STOP
    - step: "home two stone"
      arm:
        <<: *HOME_TWO_STONE

  STORE_WHEN_TWO_STONE0:
    - step: "open gripper"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "move joint1 and 3"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *SLOWLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "close gripper"
      gripper:
        <<: *CLOSE_GRIPPER
    - step: "home two stone"
      arm:
        <<: *HOME_THREE_STONE
    - step: "REVERSAL STOP "
      reversal:
        <<: *VELOCITY_STOP

      ###################   TAKE   ####################
  TAKE_WHEN_ONE_STONE0:
    - step: "move joint1 and 3 and 6"
      arm:
        joints: [ *JOINT1_ZERO_STONE_POSITION, *JOINT2_REVERSAL_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "REVERSAL OUT"
      reversal:
        <<: *POSITION_Z_OUT
    - step: "move joint1 and 3 and 6"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_REVERSAL_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  TAKE_WHEN_ONE_STONE00:
    - step: "open gripper"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "move joint2 to get stone"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_MORE_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "REVERSAL Z OUT"
      reversal:
        <<: *VELOCITY_PITCH_OUT
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_TAKE_TWO_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
        common:
          <<: *JOINT6_NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL STOP"
      reversal:
        <<: *VELOCITY_STOP
    - step: "avoid collision"
      joints: [ *JOINT1_ZERO_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
      common:
        <<: *NORMALLY
      tolerance:
        <<: *NORMAL_TOLERANCE
    - step: "home with no stone"
      arm:
        <<: *HOME_ZERO_STONE

  TAKE_WHEN_TWO_STONE0:
    - step: "move joint1 and 3 and 6"
      arm:
        joints: [ *JOINT1_TAKE_ONE_STONE_POSITION, *JOINT2_REVERSAL_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "move joint1 and 3 and 6"
      arm:
        joints: [ *JOINT1_TAKE_TWO_STONE_POSITION, *JOINT2_REVERSAL_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  TAKE_WHEN_TWO_STONE00:
    - step: "open gripper"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "move joint2 to get stone"
      arm:
        joints: [ *JOINT1_TAKE_TWO_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_MORE_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL OUT"
      reversal:
        <<: *VELOCITY_Z_OUT
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_TAKE_TWO_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
        common:
          <<: *JOINT6_NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL STOP"
      reversal:
        <<: *VELOCITY_STOP
    - step: "home with no stone"
      arm:
        <<: *HOME_ONE_STONE


  TAKE_WHEN_THREE_STONE0:
    - step: "move joint1 and 3 and 6"
      arm:
        joints: [ *JOINT1_TAKE_THREE_STONE_POSITION, *JOINT2_REVERSAL_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "move joint1 "
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_REVERSAL_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
  TAKE_WHEN_THREE_STONE00:
    - step: "open gripper"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "move joint2 to get stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_BACK_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_MORE_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "REVERSAL OUT"
      reversal:
        <<: *VELOCITY_Z_OUT
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_BACK_POSITION, *JOINT3_TAKE_STORE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
        common:
          <<: *JOINT6_NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "home with no stone"
      arm:
        <<: *HOME_TWO_STONE


  ADD:
    - step: "add scenes"
      scene_name: MID_SMALL_ISLAND

  THREE_STONE_SMALL_ISLAND0:
    - step: "island gimbal"
      gimbal:
        <<: *ISLAND_POS
    - step: "arm wait"
      arm:
        <<: *PICK_WAIT
    - step: "arm ready to get stone"
      arm:
        joints: [ *JOINT1_READY_TO_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "chassis back"
      chassis:
        <<: *CHASSIS_BACKWARD
  THREE_STONE_SMALL_ISLAND00:
    - step: "add scenes"
      scene_name: MID_SMALL_ISLAND
    - step: "change gripper state"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "arm get  first stone"
      arm:
        joints: [ *JOINT1_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "arm up stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "right stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION,*JOINT5_REVERSAL_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "reversal stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_MID_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION,*JOINT5_REVERSAL_POSITION, *JOINT6_REVERSAL_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "move joint1 and 3"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "move joint6"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *SLOWLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "change gripper state"
      gripper:
        <<: *CLOSE_GRIPPER
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_TWO_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *SLOWLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "arm ready to get  second stone"
      arm:
        joints: [ *JOINT1_READY_TO_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_LF_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "change gripper state"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "REVERSAL STOP "
      reversal:
        <<: *VELOCITY_STOP
    - step: "move arm down to gain stone"
      arm:
        joints: [ *JOINT1_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_LF_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "move arm up"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_LF_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "right stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_LF_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "reversal stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_LF_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION, *JOINT5_REVERSAL_POSITION, *JOINT6_REVERSAL_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "move joint1 and 3"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "move joint6"
      arm:
        joints: [ *STONE_STORAGE_HIGH_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "change gripper state"
      gripper:
        <<: *CLOSE_GRIPPER
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_TWO_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_HOLD_STONE_POSITION ]
        common:
          <<: *SLOWLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "arm ready"
      arm:
        joints: [ *JOINT1_READY_TO_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_RT_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "change gripper state"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "REVERSAL STOP "
      reversal:
        <<: *VELOCITY_STOP
    - step: "arm get stone"
      arm:
        joints: [ *JOINT1_GET_STONE_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_RT_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "arm up stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_RT_TAKE_POSITION, *JOINT4_UP_POSITION, *JOINT5_MID_POSITION, *JOINT6_DOWN_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *NORMAL_TOLERANCE
    - step: "reversal stone"
      arm:
        joints: [ *JOINT1_UP_POSITION, *JOINT2_RECENTLY_POSITION, *JOINT3_RT_TAKE_RIGHT_POSITION, *JOINT4_UP_POSITION, *JOINT5_REVERSAL_POSITION, *JOINT6_REVERSAL_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL stop "
      reversal:
        <<: *VELOCITY_STOP
    - step: "move joint1 and 3"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_UP_POSITION ]
        common:
          <<: *QUICKLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "REVERSAL Z IN "
      reversal:
        <<: *VELOCITY_Z_IN
    - step: "move joint6"
      arm:
        joints: [ *JOINT1_THREE_STONE_POSITION, *JOINT2_BACK_POSITION, *JOINT3_STORE_STONE_POSITION, *JOINT4_UP_POSITION, *JOINT5_LEFT_POSITION, *JOINT6_BACK_POSITION ]
        common:
          <<: *SLOWLY
        tolerance:
          <<: *BIGGER_TOLERANCE
    - step: "change gripper state"
      gripper:
        <<: *CLOSE_GRIPPER
    - step: "home three stone"
      arm:
        <<: *HOME_THREE_STONE
    - step: "REVERSAL Z IN with delay "
      reversal:
        <<: *VELOCITY_Z_IN_DELAY
  THREE_STONE_SMALL_ISLAND000:
    - step: "home three stone"
      arm:
        <<: *HOME_THREE_STONE
    - step: "change gripper state"
      gripper:
        <<: *CLOSE_GRIPPER

    #  TEST MULTI DOF CONTROLLER
  Z_IN:
    - step: "TEST"
      reversal:
        mode: "POSITION"
        values: [ 0.,0.,-10.,0.,0.,0. ]
  Z_OUT:
    - step: "TEST"
      reversal:
        mode: "POSITION"
        values: [ 0.,0.,10.,0.,0.,0. ]
  Z_REVERSAL_OUT:
    - step: "TEST"
      reversal:
        mode: "POSITION"
        values: [ 0.,0.,7.5,0.,0.,0. ]
  POSITION_STOP:
    - step: "TEST"
      reversal:
        mode: "VELOCITY"
        values: [ 0.,0.,0.,0.,0.,0. ]
  PITCH_PI:
    - step: "TEST"
      reversal:
        <<: *POSITION_PITCH_REVERSAL_PI
  PITCH_PI_2:
    - step: "TEST"
      reversal:
        <<: *POSITION_PITCH_REVERSAL_PI_2

  ROLL:
    - step: "TEST"
      reversal:
        mode: "POSITION"
        values: [ 0.,0.,0.,30,0.,0. ]
  VELOCITY:
    - step: "TEST"
      reversal:
        mode: "VELOCITY"
        values: [ 1.,1.,1.,1.,1.,1. ]
  VELOCITY_STOP:
    - step: "TEST"
      reversal:
        mode: "VELOCITY"
        values: [ 0.,0.,0.,0.,0.,0. ]

  ### ljq's part
  AUTO:
    #    - step: "add scenes"
    #      scene_name: EXCHANGER
    - step: "move to wait"
      arm:
        frame: exchanger
        position: [ -0.18, 0., -11110.08 ]
        rpy: [ 0., -1.57, 0. ]
        tolerance_position: 0.01
        common:
          <<: *NORMALLY

  EXCHANGE_GENERATE:
    - step: "move to wait"
      arm:
        frame: exchanger
        position: [ 0., 0., -0.5 ]
        rpy: [ 0., 3.14, 1.57 ]
        tolerance_position: 0.001
        tolerance_orientation: 0.005
        common:
          <<: *SLOWLY
  #    - step: "add scenes"
  #      scene_name: STONE
  #    - step: "add scenes"
  #      scene_name: EXCHANGER
  #    - step: "move to wait"
  #      arm:
  #        frame: exchanger
  #        position: [ -0.18, 0., -110.12 ]
  #        rpy: [ 0., -1.57, 0. ]
  #        common:
  #          <<: *SLOWLY

  EXCHANGE_AUTO:
    - step: "move to wait"
      arm:
        frame: exchanger
        position: [ 0., 0., -0.50 ]
        rpy: [ 0., 3.14,1.57 ]
        tolerance_position: 0.001
        tolerance_orientation: 0.005
        common:
          <<: *SLOWLY

  TEST_AUTO:
    - step: "move to wait"
      arm:
        frame: link6
        position: [ 0., 0., -0.50 ]
        rpy: [ 0., 0., 0. ]
        tolerance_position: 0.001
        tolerance_orientation: 0.005
        common:
          <<: *SLOWLY
  TEST1:
    - step: "add scenes"
      scene_name: EXCHANGER
    - step: "add scenes"
      scene_name: STONE
    - step: "move to wait"
      arm:
        frame: exchanger
        position: [ -0.18, 0., -110.12 ]
        rpy: [ 0., -1.57, 0. ]
        common:
          <<: *SLOWLY

  TEST3:
    - step: "add scenes"
      scene_name: STONE
    - step: "move to wait"
      arm:
        frame: exchanger
        position: [ -0.18, 0., -110.12 ]
        rpy: [ 0., -1.57, 0. ]
        common:
          <<: *SLOWLY

  TEST2:
    - step: "move to wait"
      arm:
        frame: exchanger
        position: [ 0., 0.19, -0.1 ]
        rpy: [ 0., 3.14, 1.57 ]
        stone: 3
        tolerance_position: 0.0001
        tolerance_orientation: 0.0003
        common:
          <<: *SLOWLY
    - step: "move to wait"
      arm:
        frame: exchanger
        position: [ -0.18, 0., -110.12 ]
        rpy: [ 0., -1.57, 0. ]
        common:
          <<: *SLOWLY

  TEST6:
    - step: "move to wait"
      arm:
        frame: exchanger
        position: [ 0., 0.185, -0.24 ]
        rpy: [ 0., 3.14, 1.57 ]
        stone: 3
        tolerance_position: 0.0001
        tolerance_orientation: 0.0003
        common:
          <<: *SLOWLY
    - step: "move to wait"
      arm:
        frame: exchanger
        position: [ -0.18, 0., -110.12 ]
        rpy: [ 0., -1.57, 0. ]
        common:
          <<: *SLOWLY

  TEST4:
    - step: "add scenes"

  TEST_VIS:
    - step: "move to wait"
      vis:
        tolerance_position: 0.002
        tolerance_orientation: 0.008
        common:
          <<: *SLOWLY
    - step: "move to wait"
      arm:
        frame: exchanger
        position: [ -0.18, 0., -110.12 ]
        rpy: [ 0., -1.57, 0. ]
        common:
          <<: *SLOWLY

  HOLD_JOINT4:
    - step: "move joint6 to get stone"
      arm:
        joints: [ "KEEP", "KEEP", "KEEP", -1.57, "KEEP", "KEEP" ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE

  HOLD_JOINT6:
    - step: "move joint6 to get stone"
      arm:
        joints: [ "KEEP", "KEEP", "KEEP", "KEEP", "KEEP", *JOINT6_UP_POSITION ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE

  READY_EXCHANGE:
    - step: "move joint6 to get stone"
      arm:
        joints: [ "KEEP", 0.17, "KEEP", "KEEP", "KEEP","KEEP" ]
        common:
          <<: *NORMALLY
        tolerance:
          <<: *BIGGER_TOLERANCE

  AUTO_PUSH:
    - step: "PUSH"
      arm:
        frame: link6
        position: [ 0., 0.,-0.04 ]
        rpy: [ 0., 0.435, 0. ]
        tolerance_position: 0.001
        tolerance_orientation: 0.15
        common:
          <<: *SLOWLY
    - step: "close gripper"
      gripper:
        <<: *OPEN_GRIPPER
    - step: "BACK"
      arm:
        frame: link6
        position: [ 0., 0.,0.2 ]
        rpy: [ 0., -0.435, 0. ]
        tolerance_position: 0.005
        tolerance_orientation: 0.1
        common:
          <<: *SLOWLY
    - step: "PUSH"
      arm:
        frame: link6
        position: [ 0., 0.,-0.22 ]
        rpy: [ 0., 0., 0. ]
        tolerance_position: 0.01
        tolerance_orientation: 0.3
        common:
          <<: *NORMALLY
